<div class="min-h-screen bg-gray-50 p-6">
  <!-- Header Section -->
  <div class="mb-8">
    <div
      class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4"
    >
      <div>
        <h2 class="text-3xl font-bold text-gray-900">Budget Management</h2>
        <p class="text-gray-600 mt-2">
          Manage your monthly budget and track spending against your targets
        </p>
      </div>
      <div class="flex flex-wrap gap-2">
        <button
          *ngIf="!isEditing"
          class="btn-primary flex items-center"
          (click)="toggleEdit()"
        >
          <i class="fas fa-edit mr-2"></i>Edit Budget
        </button>
        <div *ngIf="isEditing" class="flex gap-2">
          <button
            class="btn-success flex items-center"
            (click)="saveBudget()"
            [disabled]="!budgetForm.valid || isLoading"
          >
            <i class="fas fa-save mr-2"></i>
            {{ isLoading ? "Saving..." : "Save Budget" }}
          </button>
          <button
            class="btn-secondary flex items-center"
            (click)="cancelEdit()"
          >
            <i class="fas fa-times mr-2"></i>Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div
    *ngIf="isLoading"
    class="flex flex-col items-center justify-center py-12"
  >
    <div
      class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"
    ></div>
    <p class="text-gray-600">Loading budget data...</p>
  </div>

  <!-- Budget Summary Cards -->
  <div *ngIf="!isLoading" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <!-- Total Budget Card -->
    <div class="stats-card border-l-4 border-blue-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Total Budget</p>
          <p class="text-3xl font-bold text-blue-600 mt-2">
            {{ getTotalBudget() | currency }}
          </p>
        </div>
        <div
          class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center"
        >
          <i class="fas fa-wallet text-blue-600 text-xl"></i>
        </div>
      </div>
    </div>

    <!-- Total Spent Card -->
    <div class="stats-card border-l-4 border-amber-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Total Spent</p>
          <p class="text-3xl font-bold text-amber-600 mt-2">
            {{ getTotalActual() | currency }}
          </p>
        </div>
        <div
          class="w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center"
        >
          <i class="fas fa-chart-line text-amber-600 text-xl"></i>
        </div>
      </div>
    </div>

    <!-- Remaining Budget Card -->
    <div
      class="stats-card border-l-4"
      [class.border-green-500]="getTotalRemaining() >= 0"
      [class.border-red-500]="getTotalRemaining() < 0"
    >
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Remaining</p>
          <p
            class="text-3xl font-bold mt-2"
            [class.text-green-600]="getTotalRemaining() >= 0"
            [class.text-red-600]="getTotalRemaining() < 0"
          >
            {{ getTotalRemaining() | currency }}
          </p>
        </div>
        <div
          class="w-12 h-12 rounded-full flex items-center justify-center"
          [class.bg-green-100]="getTotalRemaining() >= 0"
          [class.bg-red-100]="getTotalRemaining() < 0"
        >
          <i
            class="fas text-xl"
            [class.fa-check-circle]="getTotalRemaining() >= 0"
            [class.fa-exclamation-circle]="getTotalRemaining() < 0"
            [class.text-green-600]="getTotalRemaining() >= 0"
            [class.text-red-600]="getTotalRemaining() < 0"
          ></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Budget Charts -->
  <div *ngIf="!isLoading" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- Budget Allocation Chart -->
    <div class="chart-container">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-semibold text-gray-900">Budget Allocation</h3>
        <div class="text-sm text-gray-600">By Category</div>
      </div>
      <div echarts [options]="budgetChartOption" class="w-full h-80"></div>
    </div>

    <!-- Budget vs Actual Chart -->
    <div class="chart-container">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-semibold text-gray-900">Budget vs Actual</h3>
        <div class="text-sm text-gray-600">Spending Comparison</div>
      </div>
      <div echarts [options]="budgetVsActualOption" class="w-full h-80"></div>
    </div>
  </div>

  <!-- Budget Table -->
  <div *ngIf="!isLoading" class="bg-white rounded-xl shadow-sm overflow-hidden">
    <!-- Table Header -->
    <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
      <h3 class="text-lg font-semibold text-gray-900">
        Category-wise Budget Details
      </h3>
      <p class="text-sm text-gray-600 mt-1">
        Track your budget performance across categories
      </p>
    </div>

    <!-- Table Content -->
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Category
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Budgeted Amount
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Actual Spent
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Remaining
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Status
            </th>
            <th
              *ngIf="isEditing"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Edit
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr
            *ngFor="let category of categories"
            class="hover:bg-gray-50 transition-colors duration-150"
          >
            <!-- Display Mode -->
            <ng-container *ngIf="!isEditing">
              <!-- <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div
                    class="w-3 h-3 rounded-full mr-3"
                    [style.background]="getCategoryColor(category)"
                  ></div>
                  <span class="font-medium text-gray-900">{{ category }}</span>
                </div>
              </td> -->
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ budgetData?.budget[category] || 0 | currency }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ budgetData?.actualExpenses[category] || 0 | currency }}
              </td>
              <td
                class="px-6 py-4 whitespace-nowrap text-sm font-medium"
                [class.text-green-600]="getRemainingBudget(category) >= 0"
                [class.text-red-600]="getRemainingBudget(category) < 0"
              >
                {{ getRemainingBudget(category) | currency }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="status-badge"
                  [class]="getStatusBadgeClass(category)"
                >
                  {{ getStatusText(category) }}
                </span>
              </td>
            </ng-container>

            <!-- Edit Mode -->
            <ng-container *ngIf="isEditing">
              <!-- <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div
                    class="w-3 h-3 rounded-full mr-3"
                    [style.background]="getCategoryColor(category)"
                  ></div>
                  <span class="font-medium text-gray-900">{{ category }}</span>
                </div>
              </td> -->
              <td class="px-6 py-4 whitespace-nowrap">
                <input
                  type="number"
                  class="form-control w-32"
                  [formControlName]="category"
                  min="0"
                  step="0.01"
                  placeholder="0.00"
                />
                <div
                  *ngIf="
                    budgetForm.get(category)?.invalid &&
                    budgetForm.get(category)?.touched
                  "
                  class="mt-1 text-xs text-red-600"
                >
                  Please enter a valid amount
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ budgetData?.actualExpenses[category] || 0 | currency }}
              </td>
              <td
                class="px-6 py-4 whitespace-nowrap text-sm font-medium"
                [class.text-green-600]="getRemainingBudget(category) >= 0"
                [class.text-red-600]="getRemainingBudget(category) < 0"
              >
                {{ getRemainingBudget(category) | currency }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span
                  class="status-badge"
                  [class]="getStatusBadgeClass(category)"
                >
                  {{ getStatusText(category) }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <!-- Optional edit actions can go here -->
              </td>
            </ng-container>
          </tr>
        </tbody>
        <tfoot class="bg-gray-50">
          <tr class="border-t-2 border-gray-300">
            <td
              class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900"
            >
              Total
            </td>
            <td
              class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900"
            >
              {{ getTotalBudget() | currency }}
            </td>
            <td
              class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900"
            >
              {{ getTotalActual() | currency }}
            </td>
            <td
              class="px-6 py-4 whitespace-nowrap text-sm font-semibold"
              [class.text-green-600]="getTotalRemaining() >= 0"
              [class.text-red-600]="getTotalRemaining() < 0"
            >
              {{ getTotalRemaining() | currency }}
            </td>
            <td
              [attr.colspan]="isEditing ? 2 : 1"
              class="px-6 py-4 whitespace-nowrap"
            >
              <span
                class="status-badge text-sm font-semibold"
                [class.bg-green-100]="getTotalRemaining() >= 0"
                [class.text-green-800]="getTotalRemaining() >= 0"
                [class.bg-red-100]="getTotalRemaining() < 0"
                [class.text-red-800]="getTotalRemaining() < 0"
              >
                {{ getTotalRemaining() >= 0 ? "Within Budget" : "Over Budget" }}
              </span>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <!-- Budget Tips -->
  <div *ngIf="!isLoading" class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-blue-50 rounded-xl p-6 border border-blue-200">
      <h4 class="text-lg font-semibold text-blue-900 mb-3">Budgeting Tips</h4>
      <ul class="space-y-2 text-blue-800">
        <li class="flex items-start">
          <i class="fas fa-lightbulb mr-2 mt-1 text-blue-600"></i>
          <span
            >Review and adjust your budget monthly based on actual
            spending</span
          >
        </li>
        <li class="flex items-start">
          <i class="fas fa-lightbulb mr-2 mt-1 text-blue-600"></i>
          <span>Set aside 10-20% of income for savings and investments</span>
        </li>
        <li class="flex items-start">
          <i class="fas fa-lightbulb mr-2 mt-1 text-blue-600"></i>
          <span
            >Track variable expenses closely to identify spending patterns</span
          >
        </li>
      </ul>
    </div>

    <div class="bg-amber-50 rounded-xl p-6 border border-amber-200">
      <h4 class="text-lg font-semibold text-amber-900 mb-3">Quick Actions</h4>
      <div class="space-y-3">
        <button
          class="w-full btn-secondary text-left flex items-center justify-between p-3"
        >
          <span>Export Budget Report</span>
          <i class="fas fa-download"></i>
        </button>
        <button
          class="w-full btn-secondary text-left flex items-center justify-between p-3"
        >
          <span>Set Budget Alerts</span>
          <i class="fas fa-bell"></i>
        </button>
        <button
          class="w-full btn-secondary text-left flex items-center justify-between p-3"
        >
          <span>Compare with Previous Month</span>
          <i class="fas fa-chart-bar"></i>
        </button>
      </div>
    </div>
  </div>
</div>
